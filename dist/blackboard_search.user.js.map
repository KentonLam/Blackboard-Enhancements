{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/blackboard_search.user.js","webpack:///external \"jQuery\"","webpack:///external \"jQuery.featherlight\"","webpack:///external \"Fuse\"","webpack:///external \"_\"","webpack:///external \"GM_configStruct\"","webpack:///external \"LZString\"","webpack:///./src/blackboard_search.css","webpack:///./node_modules/css-loader/lib/css-base.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;;;;;;;;;;ACnEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB,aAAa,0BAA0B,mBAAmB,wBAAwB,oBAAoB,yBAAyB,WAAW,wBAAwB,gBAAgB,WAAW,oCAAoC,WAAW,qBAAqB;AAClR;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,2BAA2B,qCAAqC;AAChE;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,+BAA+B,4BAA4B;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,uBAAuB,UAAU;AACjC;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,2BAA2B,8BAA8B;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;;AAErB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,6BAA6B;AACxD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,oD;AACA;AACA,iBAAiB;AACjB,mCAAmC,2BAA2B;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;;AAEA,+BAA+B,kCAAkC;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;;AAEA;AACA;AACA,4BAA4B,mCAAmC;;AAE/D;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;;AAEjB;AACA;;AAEA;AACA;AACA,2BAA2B,iCAAiC;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,oE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,kD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,2BAA2B;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,2BAA2B,4BAA4B;AACvD;AACA,gC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,kCAAkC,EAAE,MAAM,IAAI,MAAM,IAAI,QAAQ,EAAE,MAAM,IAAI,MAAM,IAAI;AACtF,+BAA+B,0BAA0B;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,iBAAiB;AACjB;AACA;AACA;;AAEA;AACA;AACA;AACA,2BAA2B,yBAAyB;AACpD;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,E;AACjB;;AAEA;;AAEA;AACA;AACA;AACA,aAAa;AACb,2BAA2B,yBAAyB;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qGAA6D;AAC7D,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB;AACA,aAAa;;AAEb;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;;AAEA;AACA,2B;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,0C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gC;;;;;;ACj+BA,wB;;;;;;ACAA,qC;;;;;;ACAA,sB;;;;;;ACAA,mB;;;;;;ACAA,iC;;;;;;ACAA,0B;;;;;;ACAA;AACA;;;AAGA;AACA,oDAAqD,sCAAsC,wCAAwC,8BAA8B,KAAK,mDAAmD,+BAA+B,4BAA4B,SAAS,KAAK,mDAAmD,+BAA+B,0CAA0C,SAAS,KAAK,kCAAkC,yBAAyB,4BAA4B,0BAA0B,2BAA2B,KAAK,oCAAoC,8BAA8B,yBAAyB,4BAA4B,qBAAqB,kBAAkB,yBAAyB,yBAAyB,SAAS,2CAA2C,qBAAqB,sBAAsB,gCAAgC,8CAA8C,mCAAmC,aAAa,oDAAoD,mCAAmC,KAAK,4BAA4B,sCAAsC,KAAK,+CAA+C,8BAA8B,KAAK,mCAAmC,wBAAwB,4BAA4B,6CAA6C,KAAK,kCAAkC,oBAAoB,KAAK,mCAAmC,0BAA0B,oBAAoB,wBAAwB,KAAK,0CAA0C,mCAAmC,wBAAwB,KAAK,uCAAuC,+BAA+B,qCAAqC,KAAK,4BAA4B,uBAAuB,yBAAyB,oBAAoB,2BAA2B,KAAK,mCAAmC,2BAA2B,KAAK,4CAA4C,wBAAwB,KAAK,8BAA8B,0BAA0B,KAAK;;AAEpjE;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,mCAAmC,gBAAgB;AACnD,IAAI;AACJ;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAgB,iBAAiB;AACjC;AACA;AACA;AACA;AACA,YAAY,oBAAoB;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,oDAAoD,cAAc;;AAElE;AACA","file":"blackboard_search.user.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","// ==UserScript==\r\n// @name        Blackboard Search Enhancements\r\n// @author      Kenton Lam\r\n// @description Searches blackboard\r\n// @match       https://learn.uq.edu.au/*\r\n// @match       https://ilearn.bond.edu.au/*\r\n// @version     VERSION\r\n// @grant       GM_getValue\r\n// @grant       GM_setValue\r\n// @grant       GM_deleteValue\r\n// @require     https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js\r\n// @require     https://cdnjs.cloudflare.com/ajax/libs/featherlight/1.7.13/featherlight.min.js\r\n// @require     https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js\r\n// @require     https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.min.js\r\n// @require     https://openuserjs.org/src/libs/sizzle/GM_config.js\r\n// @require     https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.js\r\n// ==/UserScript==\r\n\r\n// These imports are so VSCode recognises the libraries. \r\n// They are removed by webpack and loaded via TamperMonkey's @require.\r\nimport jQuery from 'jquery';\r\nimport 'featherlight';\r\nimport Fuse from 'fuse.js';\r\nimport _ from 'lodash';\r\nimport GM_configStruct from 'gm_config';\r\nimport LZString from 'lz-string';\r\n\r\n// Load CSS into a string which we can use.\r\nimport blackboardCss from './blackboard_search.css';\r\n\r\n/* Queue.js */\r\n/* eslint-disable */\r\n//code.iamkate.com\r\nfunction Queue(){var a=[],b=0;this.getLength=function(){return a.length-b};this.isEmpty=function(){return 0==a.length};this.enqueue=function(b){a.push(b)};this.dequeue=function(){if(0!=a.length){var c=a[b];2*++b>=a.length&&(a=a.slice(b),b=0);return c}};this.peek=function(){return 0<a.length?a[b]:void 0}};\r\n/* eslint-enable */\r\n\r\nfunction BlackboardSearch() {\r\n    if (window.location.href.indexOf('/courseMenu.jsp') !== -1) return;\r\n\r\n    let $ = jQuery.noConflict(true);\r\n\r\n    // todo debug check before console log.\r\n\r\n    class UniHelper {\r\n        constructor(pageUrl) {\r\n            this.uni = {};\r\n            this.detectUni(pageUrl);\r\n        }\r\n\r\n        detectUni(pageUrl) {\r\n            for (let i = 0; i < UniHelper.uniDefinitions.length; i++) {\r\n                const uni = UniHelper.uniDefinitions[i];\r\n                if (_.startsWith(pageUrl, uni.baseUrl)) {\r\n                    this.uni = uni;\r\n                    DEBUG && console.log('Matched: ' + uni.baseUrl);\r\n                }\r\n            }\r\n\r\n            if (!this.uni) {\r\n                console.log('Unknown university: ' + pageUrl);\r\n                this.uni = UniHelper.uniDefinitions[0];\r\n            }\r\n        }\r\n\r\n        parseCourse(courseString) {\r\n            if (this.uni.parseCourse) {\r\n                return this.uni.parseCourse(courseString);\r\n            } else {\r\n                return UniHelper.uniDefinitions[0].parseCourse(courseString);\r\n            }\r\n        }\r\n\r\n        parseUrl(url) {\r\n            if (this.uni.parseUrl) {\r\n                return this.uni.parseUrl(url);\r\n            } else {\r\n                let match = /[&?]course_id=([^&?]+)/.exec(url);\r\n                if (!match) return null;\r\n                return match[1];\r\n            }\r\n        }\r\n\r\n        getIFrameUrl(courseId) {\r\n            if (this.uni.getIFrameUrl) {\r\n                return this.uni.getIFrameUrl(courseId);\r\n            } else {\r\n                return this.uni.baseUrl + 'webapps/blackboard/content/courseMenu.jsp?course_id=' + \r\n                    courseId +'&newWindow=true';\r\n            }\r\n        }\r\n    }\r\n    UniHelper.uniDefinitions = [\r\n        {\r\n            // TODO we need uni-specific calendars here too.\r\n            baseUrl: 'https://learn.uq.edu.au/',\r\n            parseCourse: function (courseTitle) {\r\n                let match = /^\\[([A-Za-z0-9/]+)\\] (.*)$/.exec(courseTitle);\r\n                if (!match) return null;\r\n                \r\n                let letters = match[1].slice(0, 4);\r\n                let courseCodeArray = match[1].split('/');\r\n                for (let c = 0; c < courseCodeArray.length; c++) {\r\n                    if (courseCodeArray[c].length < 8) {\r\n                        courseCodeArray[c] = letters + courseCodeArray[c];\r\n                    }\r\n                }\r\n                return {\r\n                    courseName: match[0].replace('['+match[1]+'] ', '').trim(),\r\n                    courseCodeArray: courseCodeArray\r\n                };\r\n            }\r\n        },\r\n        {\r\n            baseUrl: 'https://ilearn.bond.edu.au/',\r\n            parseCourse: function (courseTitle) {\r\n                let m = /^([^_]+)_[^ ]+ \\((.*)\\)$/.exec(courseTitle);\r\n                return {\r\n                    courseName: m[2],\r\n                    courseCodeArray: [m[1]],\r\n                };\r\n            }\r\n        }\r\n    ];\r\n\r\n\r\n    class BlackboardTreeParser {\r\n        constructor(uniHelper) {\r\n            /** @type {UniHelper} */\r\n            this.uniHelper = uniHelper;\r\n\r\n            this.callback = function() {};\r\n            this.courseId = '';\r\n            this.retryCount = 0;\r\n            this.treeData = {};\r\n            this.locked = false;\r\n        }\r\n\r\n        parseTree(courseId, callback) {\r\n            this.courseId = courseId;\r\n            this.callback = callback;\r\n            this.retryCount = 0;\r\n            this.locked = true;\r\n            this.appendIFrame();\r\n        }\r\n\r\n        isUpdating() {\r\n            return this.locked;\r\n        }\r\n\r\n        parseOneUL(listNode, rootName) {\r\n            for (let j = 0; j < listNode.children.length; j++) {\r\n                if (listNode.children[j].tagName.toUpperCase() === 'LI') {\r\n                    let li = listNode.children[j];\r\n                    let text = li.children[2].textContent.trim();\r\n                    let thisName = _.concat(rootName, text);\r\n                    this.treeData.items.push({\r\n                        'courseId': this.courseId,\r\n                        'link': li.children[2].href,\r\n                        'label': thisName\r\n                    });\r\n    \r\n                    if (li.children.length > 3 && li.children[3].tagName.toUpperCase() === 'UL') \r\n                        this.parseOneUL(li.children[3], thisName);\r\n                }\r\n            }\r\n        }\r\n\r\n        startTreeParse(rootDiv) {\r\n            this.treeData = {\r\n                'lastUpdated': Date.now(),\r\n                'courseId': this.courseId,\r\n                'courseName': this.courseName,\r\n                'courseCodeArray': this.courseCodeArray,\r\n                'iframeSrc': this.iframeSrc,\r\n                'items': [],\r\n            };\r\n            for (let i = 0; i < rootDiv.children.length; i++) {\r\n                this.parseOneUL(rootDiv.children[i], [this.courseCodeArray.join('\\u200A/\\u200A')]);\r\n            }\r\n            return this.treeData;\r\n        }\r\n\r\n        bootstrapTreeParse() {\r\n            this.retryCount++;\r\n            function retry() {\r\n                setTimeout(this.bootstrapTreeParse.bind(this), 100*Math.pow(2, this.retryCount-1));\r\n            }\r\n            \r\n            console.log('bootstrap tree parse:');\r\n            console.log(this);\r\n            let frameDoc = this.iframe.contentDocument;\r\n            frameDoc.querySelector('#expandAllLink').click();\r\n            let div = frameDoc.querySelector('#courseMenu_folderView');\r\n            if (div === null || frameDoc.querySelector('.--empty--') !== null) {\r\n                retry.call(this);\r\n                return false;\r\n            } else {\r\n                console.log('parsing');\r\n                let tree = this.startTreeParse.call(this, div);\r\n                \r\n                if (!tree.items.length) {\r\n                    retry.call(this);\r\n                    return false;\r\n                }\r\n                this.iframe.parentNode.removeChild(this.iframe);\r\n                this.retryCount = 0;\r\n                this.locked = false;\r\n                return this.callback(tree);\r\n            }\r\n        }\r\n\r\n        iframeOnLoad() {\r\n            let parsed = this.uniHelper.parseCourse(\r\n                this.iframe.contentDocument.getElementById('courseMenu_link').textContent);\r\n\r\n            this.courseName = parsed.courseName;\r\n            this.courseCodeArray = parsed.courseCodeArray;\r\n\r\n            if (this.iframe.contentDocument.getElementById('courseMapButton'))\r\n                this.callback(null);\r\n            else\r\n                this.bootstrapTreeParse.call(this);\r\n        }\r\n\r\n        appendIFrame() {\r\n            console.log('inserting iframe');\r\n            if (document.getElementById('userscript-search-iframe') !== null) {\r\n                throw new Error('Blackboard search IFrame already exists.');\r\n            }\r\n            this.iframe = document.createElement('iframe');\r\n            this.iframe.id = 'userscript-search-iframe';\r\n            // bug this will break if someone uses multiple unis.\r\n            this.iframe.src = this.uniHelper.getIFrameUrl(this.courseId);\r\n            this.iframeSrc = this.iframe.src;\r\n            this.iframe.onload = this.iframeOnLoad.bind(this);\r\n            this.iframe.style.width = '210px';\r\n            this.iframe.style.display = 'none';\r\n            \r\n            (document.getElementById('navigationPane') || document.body).appendChild(this.iframe);\r\n        }\r\n    }\r\n\r\n    class BlackboardSearchManager {\r\n        constructor(pageUrl) {\r\n            this.courseDataObject = {};\r\n            this.linkItems = [];\r\n            this.fuse = new Fuse(this.linkItems, {\r\n                shouldSort: true,\r\n                tokenize: true,\r\n                matchAllTokens: true,\r\n                maxPatternLength: 32,\r\n                minMatchCharLength: 5,\r\n                keys: [\r\n                    'text'\r\n                ],\r\n                threshold: 0.3,\r\n            });\r\n            this.selectedRow = null;\r\n            this.coursesToUpdate = [];\r\n\r\n            this.uniHelper = new UniHelper(pageUrl);\r\n            this.pageCourseId = this.uniHelper.parseUrl(pageUrl);\r\n\r\n            this.parser = new BlackboardTreeParser(this.uniHelper);\r\n\r\n            this.config = new GM_configStruct();\r\n            /**\r\n             * @type {Object<string, Date>[]}\r\n             */\r\n            this.weekDefinitions = [];\r\n            this.selectedCourses = [];\r\n            this.customLinks = [];\r\n            this.initialiseSettings();\r\n\r\n            this.checkCurrentCourse();\r\n        }\r\n\r\n        checkCurrentCourse() {\r\n            if (!this.pageCourseId) \r\n                return;\r\n            if (this.courseDataObject.hasOwnProperty(this.pageCourseId))\r\n                return;\r\n            let parsedCourse = this.uniHelper.parseCourse(\r\n                document.getElementById('courseMenu_link').textContent);\r\n            let codes = parsedCourse.courseCodeArray;\r\n            if (this.inSelectedCourses(codes)) {\r\n                console.log('adding current page');\r\n                this.queueUpdateCourse(this.pageCourseId);\r\n                return true;\r\n            }\r\n            console.log('not adding current page');\r\n            return false;\r\n        }\r\n\r\n        doSearch(event, force=false) {\r\n            if (!force && !$.featherlight.current()) return false;\r\n\r\n            while (this.searchResults.hasChildNodes()) {\r\n                this.searchResults.removeChild(this.searchResults.lastChild);\r\n            }\r\n            let query = this.searchBox.value.trim();\r\n\r\n            let selectedRowInResults = false;\r\n            if (!query) {\r\n                if (this.customLinks.length) {\r\n                    for (const link of this.customLinks) {\r\n                        this.searchResults.appendChild(link.element);\r\n                        $(link.element).fadeIn(200);                        \r\n                    }\r\n                } else {\r\n                    for (let i = 0; i < this.linkItems.length; i++) {\r\n                        const item = this.linkItems[i];\r\n                        // todo label to path\r\n                        if (item.label[1] === 'Announcements') {\r\n                            this.searchResults.appendChild(item.element);\r\n                            $(item.element).fadeIn(200);\r\n                            if (item.element === this.selectedRow)\r\n                                selectedRowInResults = true;\r\n                        }\r\n                    }\r\n                }\r\n                if (!selectedRowInResults && this.searchResults.firstElementChild) {\r\n                    this.selectRow(this.searchResults.firstElementChild);\r\n                }\r\n            } else {\r\n                let results = this.fuse.search(query);\r\n                \r\n                for (let i = 0; i < Math.min(results.length, 50); i++) {\r\n                    let r = results[i].element;\r\n                    this.searchResults.appendChild(r);\r\n                    $(r).hide().fadeIn(200);\r\n                    if (r === this.selectedRow)\r\n                        selectedRowInResults = true;\r\n                }\r\n                if (!selectedRowInResults && results.length) {\r\n                    this.selectRow(results[0].element);\r\n                }\r\n            }\r\n\r\n            if (event) {\r\n                event.preventDefault();\r\n            }\r\n            return false;\r\n        }\r\n\r\n        selectPreviousRow() {\r\n            if (this.selectedRow.previousElementSibling)\r\n                this.selectRow(this.selectedRow.previousElementSibling);\r\n            else \r\n                this.selectRow(this.selectedRow.parentNode.lastElementChild);\r\n        }\r\n\r\n        selectNextRow() {\r\n            if (this.selectedRow.nextElementSibling)\r\n                this.selectRow(this.selectedRow.nextElementSibling);\r\n            else \r\n                this.selectRow(this.selectedRow.parentNode.firstElementChild);\r\n        }\r\n\r\n        selectRow(row) {\r\n            if (row) {\r\n                row.classList.add('search-selected');\r\n                row.firstElementChild.focus();\r\n                this.searchBox.focus();\r\n            }\r\n            if (this.selectedRow)\r\n                this.selectedRow.classList.remove('search-selected');\r\n            this.selectedRow = row;\r\n        }\r\n\r\n        searchKeyHandler(event) {\r\n            switch (event.which) {\r\n            case 38: // up\r\n                if (!this.selectedRow)\r\n                    this.selectRow(this.searchResults.firstElementChild);\r\n                else \r\n                    this.selectPreviousRow();\r\n                break;\r\n    \r\n            case 40: // right\r\n                if (!this.selectedRow)\r\n                    this.selectRow(this.searchResults.firstElementChild);\r\n                else \r\n                    this.selectNextRow();\r\n                break;\r\n\r\n            case 13:\r\n                if (this.selectedRow)\r\n                    this.selectedRow.firstElementChild.click();\r\n                break;\r\n            default: return; // exit this handler for other keys\r\n            }\r\n            event.preventDefault();\r\n        }\r\n\r\n        tickTime() {\r\n            this.timeSpan.textContent = new Date().toLocaleTimeString(  \r\n                undefined, {hour: '2-digit', minute: '2-digit'});\r\n\r\n            if ($.featherlight.current()) {\r\n                setTimeout(this.tickTime.bind(this), 60000-Date.now()%60000);\r\n            }\r\n        }\r\n\r\n        tickDateAndCalendar() {\r\n            this.dateSpan.textContent = new Date().toLocaleDateString(undefined,\r\n                {\r\n                    weekday: 'long',\r\n                    day: 'numeric',\r\n                    month: 'long',\r\n                    year: 'numeric'\r\n                });\r\n\r\n            this.semesterSpan.textContent = '';\r\n            this.weekSpan.textContent = '';\r\n\r\n            let now = new Date();\r\n            let msPerWeek = 7*24*60*60*1000;\r\n            for (let d = 0; d < this.weekDefinitions.length; d++) {\r\n                const w = this.weekDefinitions[d];\r\n                if (now >= w.startDate && now < w.endDate) {\r\n                    this.weekSpan.textContent = 'Week ' + \r\n                        (Math.max(Math.floor((now-w.startMonday) / msPerWeek), 0) + w.startNum);\r\n                    this.semesterSpan.textContent = w.name;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if ($.featherlight.current()) {\r\n                let msPerDay = 24*60*60*1000;\r\n                setTimeout(this.tickDateAndCalendar.bind(this), \r\n                    msPerDay-Date.now()%msPerDay);\r\n            }\r\n        }\r\n\r\n        refreshTimeElements() {\r\n            this.tickTime();\r\n            this.tickDateAndCalendar();\r\n        }\r\n\r\n        createElement(element, options) {\r\n            var el = document.createElement(element);\r\n            if (options)\r\n                _.assign(el, options);\r\n            return el;\r\n        }\r\n\r\n        createWindow() {\r\n            this.searchWindow = document.createElement('div');\r\n            this.searchWindow.id = 'userscript-search-window';\r\n\r\n            this.header = document.createElement('div');\r\n            this.header.id = 'userscript-header';\r\n            \r\n            this.dateTimeSpan = document.createElement('span');\r\n            this.dateTimeSpan.id = 'userscript-date-time';\r\n            this.timeSpan = document.createElement('span');\r\n            this.timeSpan.id = 'userscript-time';\r\n            this.dateSpan = document.createElement('span');\r\n            this.dateSpan.id = 'userscript-date';\r\n            this.dateTimeSpan.appendChild(this.timeSpan);\r\n            this.dateTimeSpan.appendChild(document.createElement('br'));\r\n            this.dateTimeSpan.appendChild(this.dateSpan);\r\n\r\n            this.tickTime();\r\n            this.header.appendChild(this.dateTimeSpan);\r\n\r\n            this.calendar = this.createElement('span', {\r\n                id: 'userscript-calendar'\r\n            });\r\n            this.weekSpan = this.createElement('span', {\r\n                id: 'userscript-week',\r\n                textContent: 'Week 4',\r\n            });\r\n            this.calendar.appendChild(this.weekSpan);\r\n            this.calendar.appendChild(this.createElement('br'));\r\n            this.semesterSpan = this.createElement('span', {\r\n                id: 'userscript-semester',\r\n                textContent: 'Semester 1, 2018',\r\n            });\r\n            this.calendar.appendChild(this.semesterSpan);\r\n            this.tickDateAndCalendar();\r\n            this.header.appendChild(this.calendar);\r\n\r\n            this.searchWindow.appendChild(this.header);\r\n\r\n            this.searchForm = document.createElement('form');\r\n            this.searchForm.id = 'userscript-search-form';\r\n            \r\n            this.searchBox = document.createElement('input');\r\n            this.searchBox.id = 'userscript-search-input';\r\n            this.searchBox.type = 'search';\r\n            this.searchBox.name = 'search';\r\n            this.searchBox.setAttribute('autocomplete', 'off');\r\n            this.searchBox.tabIndex = 0;\r\n            this.searchBox.addEventListener('input',\r\n                _.debounce(this.doSearch.bind(this), 200));\r\n            $(this.searchBox).keydown(\r\n                this.searchKeyHandler.bind(this));\r\n        \r\n            this.searchForm.appendChild(this.searchBox);\r\n        \r\n            this.searchButton = document.createElement('input');\r\n            this.searchButton.type = 'submit';\r\n            this.searchButton.style.display = 'none';\r\n            this.searchButton.onclick = _.noop;\r\n            this.searchForm.appendChild(this.searchButton);\r\n        \r\n            this.searchWindow.appendChild(this.searchForm);\r\n\r\n            this.searchResults = document.createElement('ul');\r\n            this.searchResults.id = 'userscript-search-results';\r\n            this.searchWindow.appendChild(this.searchResults);\r\n\r\n            \r\n            this.footerDiv = document.createElement('div');\r\n            this.footerDiv.id = 'userscript-search-footer';\r\n            \r\n            this.updateButton = document.createElement('a');\r\n            this.updateButton.id = 'userscript-update-button';\r\n            this.updateButton.textContent = 'Refresh';\r\n            this.updateButton.onclick = this.updateAllCourses.bind(this);\r\n            this.footerDiv.appendChild(this.updateButton);\r\n\r\n            this.footerDiv.appendChild(document.createTextNode(' | '));\r\n\r\n            this.settingsButton = document.createElement('a');\r\n            this.settingsButton.id = 'userscript-options-button';\r\n            this.settingsButton.textContent = 'Options';\r\n            this.settingsButton.onclick = this.showConfig.bind(this);\r\n            this.footerDiv.appendChild(this.settingsButton);\r\n            \r\n            this.searchWindow.appendChild(this.footerDiv);\r\n\r\n            return this.searchWindow;\r\n        }\r\n\r\n        appendSearchForm(root) {\r\n            root.appendChild(this.searchWindow);\r\n        }\r\n\r\n        updateAllCourses() {\r\n            for (const courseId in this.courseDataObject) {\r\n                if (this.courseDataObject.hasOwnProperty(courseId)) {\r\n                    this.queueUpdateCourse(courseId);\r\n                }\r\n            }\r\n        }\r\n\r\n        queueUpdateCourse(courseId) {\r\n            if (!this.parser.isUpdating()) {\r\n                this.parser.parseTree(courseId, this.parseTreeCallback.bind(this));\r\n            } else {\r\n                console.log('already updating');\r\n                this.coursesToUpdate.push(courseId);\r\n            }\r\n        }\r\n\r\n        getCourseObject(courseId) {\r\n            return this.courseDataObject[courseId];\r\n        }\r\n\r\n        maybeUpdateCourse(courseObject) {\r\n            let courseId = courseObject.courseId;\r\n            let updateInterval;\r\n            if (courseId === this.pageCourseId) \r\n                updateInterval = this.config.get('CurrentCourseUpdateInterval');\r\n            else\r\n                updateInterval = this.config.get('OtherCourseUpdateInterval');\r\n\r\n            if (Date.now() - courseObject.lastUpdated > updateInterval*60000) {\r\n                console.log('Updating '+courseId);\r\n                this.queueUpdateCourse(courseObject.courseId);\r\n            }\r\n        }\r\n\r\n        maybeUpdateAllCourses() {\r\n            for (const id in this.courseDataObject) {\r\n                if (this.courseDataObject.hasOwnProperty(id)) {\r\n                    this.maybeUpdateCourse(this.courseDataObject[id]);\r\n                }\r\n            }\r\n        }\r\n\r\n        parseTreeCallback(treeData) {\r\n            if (treeData) {\r\n                console.log(JSON.stringify(treeData, undefined, 2)); \r\n                let courseId = treeData.courseId;\r\n                this.courseDataObject[courseId] = treeData;\r\n            }\r\n            if (this.coursesToUpdate.length === 0) {\r\n                this.updateLinks();\r\n                this.storeCourseData();\r\n            } else {\r\n                let course = this.coursesToUpdate.pop();\r\n                this.queueUpdateCourse(course, true);\r\n            }\r\n        }\r\n\r\n        storeCourseData() {\r\n            this.config.set('CourseDataLZ', \r\n                LZString.compressToUTF16(JSON.stringify(this.courseDataObject)));\r\n            this.config.save();\r\n        }\r\n    \r\n        // eslint-disable-next-line no-unused-vars\r\n        formatLinkText(textArray, shorten=false) { \r\n            return textArray.join(' > ');\r\n        }\r\n\r\n        updateLinks() {\r\n            _.remove(this.linkItems, _.stubTrue);\r\n            for (const id in this.courseDataObject) {\r\n                if (this.courseDataObject.hasOwnProperty(id)) {\r\n                    this.linkItems.push(...this.courseDataObject[id].items);\r\n                }\r\n            }\r\n            const contentIdRegex = /(#[^&?]+)/;\r\n            for (let i = 0; i < this.linkItems.length; i++) {\r\n                const item = this.linkItems[i];\r\n                let li = document.createElement('li');\r\n                let a = document.createElement('a');\r\n                let match = contentIdRegex.exec(item.link);\r\n                if (match) {\r\n                    let index = item.link.indexOf(match[1]);\r\n                    a.href = item.link.slice(0, index+match[1].length);\r\n                } else {\r\n                    a.href = item.link;\r\n                }\r\n                // todo label to path.\r\n                a.textContent = this.formatLinkText(item.label, true);\r\n                li.appendChild(a);\r\n                item.element = li;\r\n                item.text = this.formatLinkText(\r\n                    _.concat(item.label[0], _.reverse(item.label.slice(1))));\r\n                item.courseCode = item.label[0];\r\n            }\r\n            return this.linkItems;\r\n        }\r\n\r\n        inCourseDataObject(courseCode) {\r\n            for (const id in this.courseDataObject) {\r\n                if (this.courseDataObject.hasOwnProperty(id)) {\r\n                    const courseData = this.courseDataObject[id];\r\n                    if (courseData.courseCodeArray.indexOf(courseCode) !== -1)\r\n                        return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        inSelectedCourses(courseCodeArray) {\r\n            if (!courseCodeArray) return false;\r\n            for (let i = 0; i < courseCodeArray.length; i++) {\r\n                if (this.selectedCourses.indexOf(courseCodeArray[i]) !== -1)\r\n                    return true;                \r\n            }\r\n            return false;\r\n        }\r\n\r\n        // todo refactor this and config related window into another class.\r\n        updateSettings() {\r\n            // Parse week definitions text box into dates.\r\n            _.remove(this.weekDefinitions, _.stubTrue);\r\n            let weekLines = this.config.get('WeekDefinitions').split('\\n');\r\n\r\n            let weekRegex = /^(\\d{4})-(\\d{1,2})-(\\d{1,2})\\s+(\\d{4})-(\\d{1,2})-(\\d{1,2})\\s+(\\d+)?\\s+(.+)$/;\r\n            for (let index = 0; index < weekLines.length; index++) {\r\n                let line = weekLines[index].trim();\r\n                try {\r\n                    let w = weekRegex.exec(line);\r\n                    if (!w) {\r\n                        console.log('Invalid week definition: '+line);\r\n                        continue;\r\n                    }\r\n                    let start = new Date(Number(w[1]), Number(w[2])-1, Number(w[3]), 0, 0, 0);\r\n                    let end = new Date(Number(w[4]), Number(w[5])-1, Number(w[6]), 24, 0, 0);\r\n                    \r\n                    // Relative Monday. For calculating week number.\r\n                    // If 'start' falls on a weekend, startMonday will be \r\n                    // the _following_ Monday. Otherwise, it is the preceding\r\n                    // Monday. Clone date object.\r\n                    let startMonday = new Date(start.getTime());\r\n                    // Where 1 = Monday, ..., 7 = Sunday.\r\n                    let startDayOfWeek = (startMonday.getDay()+6) % 7 + 1;\r\n                    if (startDayOfWeek >= 6) {\r\n                        startMonday.setDate(\r\n                            startMonday.getDate() + 7 - startDayOfWeek + 1);\r\n                    } else {\r\n                        startMonday.setDate(\r\n                            startMonday.getDate() - startDayOfWeek + 1);\r\n                    }\r\n\r\n                    let numStart;\r\n                    if (!w[7]) \r\n                        numStart = 1;\r\n                    else \r\n                        numStart = Number(w[7]);\r\n                    let text = w[8];\r\n                    this.weekDefinitions.push({\r\n                        startDate: start,\r\n                        startMonday: startMonday,\r\n                        endDate: end,\r\n                        startNum: numStart,\r\n                        name: text,\r\n                    });\r\n                } catch (e) {\r\n                    console.log('Invalid week definition: ' + line);\r\n                }\r\n            }\r\n\r\n            // Parse enabled courses into list.\r\n            _.remove(this.selectedCourses);\r\n            let splitCourses = this.config.get('SelectedCourses').split('\\n');\r\n            for (let i = 0; i < splitCourses.length; i++) {\r\n                const code = splitCourses[i];\r\n                if (code.trim()) {\r\n                    this.selectedCourses.push(code);\r\n                }\r\n                \r\n            }\r\n            \r\n            // Delete courses no longer in list.\r\n            for (const courseId in this.courseDataObject) {\r\n                if (this.courseDataObject.hasOwnProperty(courseId)) {\r\n                    if (!this.inSelectedCourses(\r\n                        this.courseDataObject[courseId].courseCodeArray)) {\r\n                        \r\n                        console.log('deleting: ' + courseId);\r\n                        this.deleteCourse(courseId);\r\n                    }\r\n                }\r\n            }\r\n\r\n            _.remove(this.customLinks, _.stubTrue);\r\n            let linkLines = this.config.get('CustomLinks').split('\\n');\r\n            const linkLineRegex = /^(.+)\\s+([^\\s]+)\\s*$/;\r\n            for (let line of linkLines) {\r\n                let match = linkLineRegex.exec(line);\r\n                if (!match) continue;\r\n                let li = document.createElement('li');\r\n                let element = document.createElement('a');\r\n                element.href = match[2];\r\n                element.textContent = match[1];\r\n                li.appendChild(element);\r\n                this.customLinks.push({\r\n                    courseId: match[1].split('>')[0].trim(),\r\n                    link: match[2],\r\n                    label: match[1],\r\n                    element: li,\r\n                });                \r\n            }\r\n\r\n        }\r\n\r\n        deleteCourse(idToDelete) {\r\n            let deletedItems = _.remove(this.linkItems, function (item) {\r\n                return item.courseId === idToDelete;\r\n            });\r\n            for (let i = 0; i < deletedItems.length; i++) {\r\n                const item = deletedItems[i];\r\n                if (item.element.parentNode) \r\n                    item.element.parentNode.removeChild(item.element);\r\n            }\r\n            delete this.courseDataObject[idToDelete];\r\n            this.storeCourseData();\r\n        }\r\n\r\n        initialiseSettings() {\r\n            this.config.init({\r\n                id: 'BlackboardSearchConfig',\r\n                title: 'Search Options',\r\n                fields: {\r\n                    'CourseDataLZ': {\r\n                        type: 'hidden',\r\n                        default: LZString.compressToUTF16('{}')\r\n                    },\r\n                    'CurrentCourseUpdateInterval': {\r\n                        label: 'Active update interval (minutes)',\r\n                        title: 'How often to update when a course page is visited.',\r\n                        type: 'unsigned float',\r\n                        default: 120\r\n                    },\r\n                    'OtherCourseUpdateInterval': {\r\n                        label: 'Background update interval (minutes)',\r\n                        type: 'unsigned float',\r\n                        default: 360\r\n                    },\r\n                    'SelectedCourses': {\r\n                        label: 'Enabled courses',\r\n                        type: 'textarea',\r\n                        default: '',\r\n                    },\r\n                    'CustomLinks': {\r\n                        label: 'Custom links',\r\n                        type: 'textarea',\r\n                        default: '',\r\n                    },\r\n                    'WeekDefinitions': {\r\n                        label: 'Calendar',\r\n                        type: 'textarea',\r\n                        default: `2018-02-19 2018-04-01 1 Semester 1\r\n2018-04-02 2018-04-15 1 Mid-semester Break — Semester 1\r\n2018-04-16 2018-06-03 7 Semester 1\r\n2018-06-04 2018-06-08 1 Revision Period — Semester 1\r\n2018-06-09 2018-06-24 1 Examination Period — Semester 1\r\n2018-07-23 2018-09-23 1 Semester 2\r\n2018-09-24 2018-09-30 1 Mid-semester Break — Semester 2\r\n2018-10-02 2018-10-28 10 Semester 2\r\n2018-10-29 2018-11-02 1 Revision Period — Semester 2\r\n2018-11-03 2018-11-18 1 Examination Period — Semester 2\r\n2019-02-25 2019-04-21 1 Semester 1\r\n2019-04-22 2019-04-28 1 Mid-semester Break — Semester 1\r\n2019-04-29 2019-06-02 9 Semester 1\r\n2019-06-03 2019-06-07 1 Revision Period — Semester 1\r\n2019-06-08 2019-06-23 1 Examination Period — Semester 1\r\n2019-07-22 2019-09-29 1 Semester 2\r\n2019-09-30 2019-10-06 1 Mid-semester Break — Semester 2\r\n2019-10-08 2019-10-27 11 Semester 2\r\n2019-10-28 2019-11-01 1 Revision Period — Semester 2\r\n2019-11-02 2019-11-17 1 Examination Period — Semester 2`,\r\n                    }\r\n                },\r\n                events: {\r\n                    save: this.updateSettings.bind(this),\r\n                },\r\n                css: configCss,\r\n            });\r\n            \r\n            let courseData = JSON.parse(LZString.decompressFromUTF16(this.config.get('CourseDataLZ')));\r\n\r\n            _.assign(this.courseDataObject, courseData);\r\n            this.updateLinks();\r\n            this.updateSettings();\r\n        }\r\n\r\n        showConfig() {\r\n            $.featherlight.current().close();\r\n            this.config.open();\r\n        }\r\n    }\r\n\r\n    console.log('Blackboard search starting.');\r\n    \r\n\r\n    let searchManager = new BlackboardSearchManager(window.location.href);\r\n    searchManager.maybeUpdateAllCourses();\r\n    let searchWindow = searchManager.createWindow();\r\n    \r\n    const SPACE = ' '.charCodeAt(0);\r\n    \r\n    function keyboardShortcut(e) {\r\n        if (e.ctrlKey && e.keyCode === SPACE) {\r\n            if ($.featherlight.current()) return;\r\n            $.featherlight($(searchWindow), {\r\n                openSpeed: 50,\r\n                closeSpeed: 200,\r\n                persist: true,\r\n                // TODO move these functions into BlackboardSearchManager\r\n                beforeOpen: function() {\r\n                    searchManager.refreshTimeElements();\r\n                    searchManager.doSearch(undefined, true);\r\n                    if (document.body.scrollHeight > document.body.clientHeight) {\r\n                        document.body.style.paddingRight = '17px';\r\n                        document.getElementsByClassName('global-nav-bar-wrap')[0].style.right = '17px';\r\n                    }\r\n                },\r\n                afterOpen: function() {\r\n                    let input = document.querySelector('#userscript-search-input');\r\n                    input.focus();\r\n                    input.select();\r\n                },\r\n                afterClose: function() {\r\n                    document.body.style.paddingRight = '0px';\r\n                    document.getElementsByClassName('global-nav-bar-wrap')[0].style.right = '0px';\r\n                }\r\n            });\r\n        }\r\n    }\r\n    \r\n    document.addEventListener('keydown', keyboardShortcut, false);\r\n}\r\n\r\nlet configCss = `\r\n#BlackboardSearchConfig * { \r\n    font-family: 'Segoe UI', 'Helvetica';\r\n}\r\n\r\nbody#BlackboardSearchConfig  {\r\n    padding: 10px;\r\n}\r\n\r\n#BlackboardSearchConfig .config_var, #BlackboardSearchConfig .field_label {\r\n    font-size: 11pt;\r\n    height: 2em;\r\n}\r\n\r\n#BlackboardSearchConfig .config_var {\r\n    display: table;\r\n    width: 100%;\r\n    text-align: right;\r\n}\r\n\r\n#BlackboardSearchConfig .field_label {\r\n    display: table-cell;\r\n    width: 70%;\r\n    vertical-align: middle;\r\n    text-align: left;\r\n    font-weight: normal;\r\n}\r\n\r\n#BlackboardSearchConfig input[type=\"text\"], #BlackboardSearchConfig textarea {\r\n    height: 2em;\r\n    width: 100%;\r\n    float: right;\r\n    padding-left: 2px;\r\n}\r\n\r\n#BlackboardSearchConfig textarea {\r\n    resize: vertical;\r\n}\r\n\r\n#BlackboardSearchConfig_resetLink {\r\n}\r\n\r\n#BlackboardSearchConfig button, #BlackboardSearchConfig .saveclose_buttons {\r\n    font-weight: normal;\r\n    font-size: 12pt;\r\n    border-width: 1px;\r\n    border-radius: 5px;\r\n    border-color: #272727;\r\n    border-style: solid;\r\n    padding: 3px 20px 3px 20px;\r\n    color: #272727;\r\n    background-color: transparent;\r\n    transition-property: background-color color;\r\n    transition-duration: 500ms;\r\n}\r\n\r\nbutton:focus {\r\n    outline: 0;\r\n}\r\n\r\n#BlackboardSearchConfig button:hover {\r\n    background-color: #272727;\r\n    color: white;\r\n}\r\n\r\n#BlackboardSearchConfig #BlackboardSearchConfig_closeBtn {\r\n    margin-right: 0px;\r\n}\r\n\r\n#BlackboardSearchConfig #BlackboardSearchConfig_WeekDefinitions_field_label, \r\n#BlackboardSearchConfig #BlackboardSearchConfig_CustomLinks_field_label {\r\n    vertical-align: top;\r\n    padding-top: 3px;\r\n    width: 30%;\r\n}\r\n\r\n#BlackboardSearchConfig #BlackboardSearchConfig_field_WeekDefinitions,\r\n#BlackboardSearchConfig #BlackboardSearchConfig_field_CustomLinks {\r\n    height: 9em;\r\n    font-family: monospace;\r\n    white-space: nowrap;\r\n    overflow-x: auto;\r\n}\r\n\r\n#BlackboardSearchConfig #BlackboardSearchConfig_SelectedCourses_field_label {\r\n    vertical-align: top;\r\n    padding-top: 3px;\r\n}\r\n\r\n#BlackboardSearchConfig #BlackboardSearchConfig_field_SelectedCourses {\r\n    height: 5.5em;\r\n    font-family: monospace;\r\n}\r\n`;\r\n\r\nlet style = document.createElement('style');\r\nstyle.type = 'text/css';\r\nstyle.id = 'userscript-search-style';\r\nstyle.appendChild(document.createTextNode(blackboardCss.toString()));\r\ndocument.head.appendChild(style);\r\n\r\nlet cssId = 'userscript-featherlight-css';  \r\nlet link  = document.createElement('link');\r\nlink.id   = cssId;\r\nlink.rel  = 'stylesheet';\r\nlink.type = 'text/css';\r\nlink.href = 'https://cdnjs.cloudflare.com/ajax/libs/featherlight/1.7.13/featherlight.min.css';\r\nlink.media = 'all';\r\nlink.onload = BlackboardSearch;\r\n\r\ndocument.head.appendChild(link);","module.exports = jQuery;","module.exports = jQuery.featherlight;","module.exports = Fuse;","module.exports = _;","module.exports = GM_configStruct;","module.exports = LZString;","exports = module.exports = require(\"../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"\\r\\n.featherlight-content {\\r\\n    border-bottom: 5px !important;\\r\\n    padding-bottom: 15px !important;\\r\\n    width: 50% !important;\\r\\n}\\r\\n\\r\\n@media only screen and (min-width: 700px) {\\r\\n    .featherlight-content {\\r\\n        min-width: 50em;\\r\\n    }\\r\\n}\\r\\n\\r\\n@media only screen and (max-width: 700px) {\\r\\n    .featherlight-content {\\r\\n        width: 91.4285714% !important;\\r\\n    }\\r\\n}\\r\\n\\r\\n#userscript-search-input {\\r\\n    padding-top: 3px;\\r\\n    padding-bottom: 3px;\\r\\n    padding-left: 3px;\\r\\n    margin-bottom: 1px;\\r\\n}\\r\\n\\r\\n#userscript-search-results {\\r\\n    list-style-type: none;\\r\\n    margin-top: 10px;\\r\\n    margin-bottom: 10px;\\r\\n    height: 19em;\\r\\n    margin: 0;\\r\\n    overflow-x: auto;\\r\\n    overflow-y: auto;    \\r\\n}\\r\\n\\r\\nul#userscript-search-results > li {\\r\\n    padding: 5px;\\r\\n    display:block;\\r\\n    text-overflow: ellipsis;\\r\\n    transition-property: background-color;\\r\\n    transition-duration: 100ms;\\r\\n    \\r\\n}\\r\\n\\r\\nul#userscript-search-results > li> a:hover {\\r\\n    text-decoration: underline;\\r\\n}\\r\\n\\r\\nli.search-selected {    \\r\\n    background-color: #e7e7e7;\\r\\n}\\r\\n\\r\\nul#userscript-search-results > li > a {\\r\\n    text-decoration: none;\\r\\n}\\r\\n\\r\\n#userscript-search-window {\\r\\n    font-size: 13pt;\\r\\n    font-weight: normal;\\r\\n    font-family: 'Segoe UI', 'Helvetica';\\r\\n}\\r\\n\\r\\n#userscript-search-input {\\r\\n    width: 100%;\\r\\n}\\r\\n\\r\\n#userscript-search-footer {\\r\\n    text-align: right;\\r\\n    color: grey;\\r\\n    font-size: 12pt;\\r\\n}\\r\\n\\r\\n#userscript-search-footer > span {\\r\\n    text-decoration: underline;\\r\\n    cursor: pointer;\\r\\n}\\r\\n\\r\\niframe#BlackboardSearchConfig { \\r\\n    width: 35% !important; \\r\\n    min-width: 400px !important;\\r\\n}\\r\\n\\r\\n#userscript-header {\\r\\n    display: table;\\r\\n    text-align: left;\\r\\n    width: 100%;\\r\\n    margin-bottom: 8px;\\r\\n}\\r\\n\\r\\n#userscript-header > span {\\r\\n    display:table-cell;\\r\\n}\\r\\n\\r\\n#userscript-time, #userscript-week {\\r\\n    font-size: 20pt;\\r\\n}\\r\\n\\r\\n#userscript-calendar {\\r\\n    text-align: right;\\r\\n}\", \"\"]);\n\n// exports\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n"],"sourceRoot":""}